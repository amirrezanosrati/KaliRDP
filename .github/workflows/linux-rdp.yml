name: Kali Linux Tools
on:
  workflow_dispatch:

jobs:
  kali-tools:
    runs-on: ubuntu-latest
    steps:
    - name: Check Docker
      run: |
        docker --version
        echo "✅ Docker is ready"

    - name: Pull Kali image and install tools
      run: |
        # نصب tools در یک container
        docker run --rm kalilinux/kali-rolling bash -c "
          echo '📦 Updating package lists...'
          apt-get update -y
          
          echo '🔧 Installing essential tools...'
          apt-get install -y --no-install-recommends \
            nmap \
            curl \
            dnsutils \
            netcat-traditional \
            iputils-ping
          
          echo '✅ Tools installed successfully!'
          echo '=== Installed Tools ==='
          nmap --version
          curl --version
          nslookup -version
          nc -h | head -1
        "

    - name: Run security examples
      run: |
        echo "🎯 Running security examples..."
        
        # ایجاد یک container با tools نصب شده
        echo "1. Network scan:"
        docker run --rm kalilinux/kali-rolling bash -c "
          apt-get update -y >/dev/null 2>&1 &&
          apt-get install -y --no-install-recommends nmap >/dev/null 2>&1 &&
          nmap -sP 8.8.8.8
        "
        
        echo "2. HTTP test:"
        docker run --rm kalilinux/kali-rolling bash -c "
          apt-get update -y >/dev/null 2>&1 &&
          apt-get install -y --no-install-recommends curl >/dev/null 2>&1 &&
          curl -I https://google.com
        "
        
        echo "3. DNS lookup:"
        docker run --rm kalilinux/kali-rolling bash -c "
          apt-get update -y >/dev/null 2>&1 &&
          apt-get install -y --no-install-recommends dnsutils >/dev/null 2>&1 &&
          nslookup google.com
        "
        
        echo "4. Ping test:"
        docker run --rm kalilinux/kali-rolling bash -c "
          apt-get update -y >/dev/null 2>&1 &&
          apt-get install -y --no-install-recommends iputils-ping >/dev/null 2>&1 &&
          ping -c 2 google.com
        "

    - name: Create custom Kali image with tools
      run: |
        echo "🐳 Creating custom Kali image with pre-installed tools..."
        
        # ایجاد Dockerfile برای image سفارشی
        cat > Dockerfile << EOF
FROM kalilinux/kali-rolling
RUN apt-get update -y \\
    && apt-get install -y --no-install-recommends \\
        nmap \\
        curl \\
        dnsutils \\
        netcat-traditional \\
        iputils-ping \\
    && apt-get clean \\
    && rm -rf /var/lib/apt/lists/*
EOF
        
        # build image
        docker build -t kali-tools .
        echo "✅ Custom Kali image built with tools!"

    - name: Test custom image
      run: |
        echo "🔧 Testing custom Kali image..."
        
        echo "1. Nmap scan:"
        docker run --rm kali-tools nmap -sP 8.8.8.8
        
        echo "2. Curl test:"
        docker run --rm kali-tools curl -I https://google.com
        
        echo "3. DNS lookup:"
        docker run --rm kali-tools nslookup google.com
        
        echo "4. Netcat test:"
        docker run --rm kali-tools nc -zv google.com 80

    - name: Show usage examples
      run: |
        echo "=========================================="
        echo "🎯 KALI TOOLS READY!"
        echo "=========================================="
        echo "🚀 Usage examples:"
        echo "docker run --rm kali-tools nmap [target]"
        echo "docker run --rm kali-tools curl [url]"
        echo "docker run --rm kali-tools nslookup [domain]"
        echo "docker run --rm kali-tools nc [host] [port]"
        echo ""
        echo "💡 Custom image 'kali-tools' has all tools pre-installed"
        echo "=========================================="
